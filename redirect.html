<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title">Loading...</title>
  <meta name="description" content="" id="page-description">
  <meta name="keywords" content="" id="page-keywords">
  <meta name="author" content="" id="page-author">
  <meta property="og:title" content="" id="og-title">
  <meta property="og:description" content="" id="og-description">
  <meta property="og:image" content="" id="og-image">
  <meta property="og:url" content="" id="og-url">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="Article Hub">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="" id="twitter-title">
  <meta name="twitter:description" content="" id="twitter-description">
  <meta name="twitter:image" content="" id="twitter-image">
  <meta name="twitter:site" content="@articlehub">
  <link rel="canonical" href="" id="canonical-link">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  
  <!-- Structured Data -->
  <script type="application/ld+json" id="structured-data">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "",
    "description": "",
    "author": {
      "@type": "Person",
      "name": ""
    },
    "publisher": {
      "@type": "Organization",
      "name": "Article Hub",
      "logo": {
        "@type": "ImageObject",
        "url": ""
      }
    },
    "datePublished": "",
    "dateModified": "",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": ""
    }
  }
  </script>
  
  <style>
    :root {
      --primary-color: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary-color: #64748b;
      --accent-color: #f59e0b;
      --success-color: #10b981;
      --error-color: #ef4444;
      --gray-50: #f8fafc;
      --gray-100: #f1f5f9;
      --gray-200: #e2e8f0;
      --gray-300: #cbd5e1;
      --gray-400: #94a3b8;
      --gray-500: #64748b;
      --gray-600: #475569;
      --gray-700: #334155;
      --gray-800: #1e293b;
      --gray-900: #0f172a;
      --max-width: 800px;
      --border-radius: 12px;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.7;
      color: var(--gray-800);
      background: var(--gray-50);
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Header */
    .site-header {
      background: white;
      border-bottom: 1px solid var(--gray-200);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
    }
    
    .header-container {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .site-logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-decoration: none;
      color: var(--gray-800);
      font-weight: 700;
      font-size: 1.25rem;
    }
    
    .site-logo:hover {
      color: var(--primary-color);
    }
    
    .header-nav {
      display: flex;
      align-items: center;
      gap: 2rem;
    }
    
    .nav-link {
      color: var(--gray-600);
      text-decoration: none;
      font-weight: 500;
      font-size: 0.875rem;
      transition: color 0.2s ease;
    }
    
    .nav-link:hover {
      color: var(--primary-color);
    }
    
    /* Main Content */
    .main-container {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 2rem;
    }
    
    /* Article */
    .article {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      margin-bottom: 3rem;
    }
    
    .article-hero {
      position: relative;
      height: 400px;
      overflow: hidden;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    }
    
    .article-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .article-image:hover {
      transform: scale(1.02);
    }
    
    .article-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
      padding: 3rem 2rem 2rem;
      color: white;
    }
    
    .article-category {
      display: inline-block;
      background: var(--accent-color);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
    }
    
    .article-title-hero {
      font-size: 2.5rem;
      font-weight: 800;
      line-height: 1.2;
      margin-bottom: 1rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .article-meta-hero {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      font-size: 0.875rem;
      opacity: 0.9;
    }
    
    .meta-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .author-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 0.75rem;
    }
    
    /* Article Content */
    .article-content {
      padding: 3rem;
    }
    
    .article-intro {
      font-size: 1.25rem;
      color: var(--gray-600);
      line-height: 1.8;
      margin-bottom: 2rem;
      font-weight: 400;
    }
    
    .article-body {
      font-size: 1.125rem;
      line-height: 1.8;
      color: var(--gray-700);
      margin-bottom: 3rem;
    }
    
    .article-body p {
      margin-bottom: 1.5rem;
    }
    
    .article-body p:last-child {
      margin-bottom: 0;
    }
    
    /* Call to Action */
    .article-cta {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      padding: 2.5rem;
      border-radius: var(--border-radius);
      text-align: center;
      color: white;
      margin: 3rem 0;
    }
    
    .cta-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }
    
    .cta-description {
      font-size: 1.125rem;
      opacity: 0.9;
      margin-bottom: 2rem;
      line-height: 1.6;
    }
    
    .cta-button {
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      background: white;
      color: var(--primary-color);
      padding: 1rem 2rem;
      border: none;
      border-radius: 50px;
      font-weight: 700;
      font-size: 1.125rem;
      text-decoration: none;
      transition: all 0.3s ease;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
    }
    
    .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
      color: var(--primary-dark);
    }
    
    .cta-button i {
      font-size: 1.25rem;
    }
    
    /* Article Footer */
    .article-footer {
      border-top: 1px solid var(--gray-200);
      padding: 2rem 3rem;
      background: var(--gray-50);
    }
    
    .article-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 2rem;
    }
    
    .tag {
      background: var(--gray-200);
      color: var(--gray-700);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 500;
      text-decoration: none;
      transition: all 0.2s ease;
    }
    
    .tag:hover {
      background: var(--primary-color);
      color: white;
    }
    
    .share-section {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .share-title {
      font-weight: 600;
      color: var(--gray-700);
    }
    
    .share-buttons {
      display: flex;
      gap: 0.75rem;
    }
    
    .share-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      color: white;
      transition: all 0.2s ease;
      font-size: 1rem;
    }
    
    .share-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .share-btn.twitter { background: #1da1f2; }
    .share-btn.facebook { background: #4267b2; }
    .share-btn.linkedin { background: #0077b5; }
    .share-btn.whatsapp { background: #25d366; }
    
    /* Loading States */
    .loading-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--gray-50);
    }
    
    .loading-content {
      text-align: center;
      max-width: 400px;
      padding: 2rem;
    }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--gray-200);
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 2rem;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gray-800);
      margin-bottom: 0.5rem;
    }
    
    .loading-description {
      color: var(--gray-600);
      font-size: 1rem;
    }
    
    /* Error States */
    .error-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--gray-50);
      padding: 2rem;
    }
    
    .error-content {
      text-align: center;
      max-width: 500px;
      background: white;
      padding: 3rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-lg);
    }
    
    .error-icon {
      font-size: 4rem;
      color: var(--error-color);
      margin-bottom: 1.5rem;
    }
    
    .error-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--gray-800);
      margin-bottom: 1rem;
    }
    
    .error-description {
      color: var(--gray-600);
      font-size: 1.125rem;
      margin-bottom: 2rem;
      line-height: 1.6;
    }
    
    .error-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s ease;
      cursor: pointer;
      font-size: 0.875rem;
    }
    
    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }
    
    .btn-secondary {
      background: var(--gray-600);
    }
    
    .btn-secondary:hover {
      background: var(--gray-700);
    }
    
    /* Permissions Error */
    .permissions-error {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-lg);
      padding: 3rem;
      margin: 2rem;
      border-left: 4px solid var(--accent-color);
    }
    
    .permissions-error h2 {
      color: var(--accent-color);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .permissions-error h3 {
      color: var(--gray-800);
      margin: 1.5rem 0 1rem;
    }
    
    .permissions-error ul {
      margin: 1rem 0;
      padding-left: 1.5rem;
    }
    
    .permissions-error li {
      margin-bottom: 0.5rem;
      color: var(--gray-700);
    }
    
    .code-block {
      background: var(--gray-900);
      color: var(--gray-100);
      padding: 1.5rem;
      border-radius: 8px;
      margin: 1rem 0;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
      font-size: 0.875rem;
      line-height: 1.6;
      overflow-x: auto;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .header-container {
        padding: 1rem;
        flex-direction: column;
        gap: 1rem;
      }
      
      .header-nav {
        gap: 1rem;
      }
      
      .main-container {
        padding: 1rem;
      }
      
      .article-hero {
        height: 250px;
      }
      
      .article-overlay {
        padding: 2rem 1.5rem 1.5rem;
      }
      
      .article-title-hero {
        font-size: 1.75rem;
      }
      
      .article-meta-hero {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
      }
      
      .article-content {
        padding: 2rem 1.5rem;
      }
      
      .article-intro {
        font-size: 1.125rem;
      }
      
      .article-body {
        font-size: 1rem;
      }
      
      .article-cta {
        padding: 2rem 1.5rem;
      }
      
      .cta-title {
        font-size: 1.25rem;
      }
      
      .cta-description {
        font-size: 1rem;
      }
      
      .article-footer {
        padding: 1.5rem;
      }
      
      .share-section {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .error-content {
        padding: 2rem 1.5rem;
      }
      
      .error-title {
        font-size: 1.5rem;
      }
      
      .error-actions {
        flex-direction: column;
      }
    }
    
    @media (max-width: 480px) {
      .article-title-hero {
        font-size: 1.5rem;
      }
      
      .article-content {
        padding: 1.5rem 1rem;
      }
      
      .article-cta {
        padding: 1.5rem 1rem;
      }
      
      .cta-button {
        padding: 0.875rem 1.5rem;
        font-size: 1rem;
      }
    }
    
    /* Print Styles */
    @media print {
      .site-header,
      .article-cta,
      .share-section {
        display: none;
      }
      
      .article {
        box-shadow: none;
        border: 1px solid var(--gray-300);
      }
      
      .article-hero {
        height: 200px;
      }
      
      body {
        background: white;
      }
    }
  </style>
</head>
<body>
  <!-- Loading State -->
  <div id="loading-state" class="loading-container">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <h2 class="loading-title">Loading Article</h2>
      <p class="loading-description">Please wait while we prepare your content...</p>
    </div>
  </div>
  
  <!-- Article Content -->
  <div id="article-content" style="display: none;">
    <!-- Header -->
    <header class="site-header">
      <div class="header-container">
        <a href="/" class="site-logo">
          <i class="fas fa-newspaper"></i>
          Article Hub
        </a>
        <nav class="header-nav">
          <a href="/" class="nav-link">Home</a>
          <a href="/admin.html" class="nav-link">Admin</a>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
      <article class="article">
        <!-- Hero Section -->
        <div class="article-hero">
          <img id="article-image" class="article-image" style="display: none;" alt="">
          <div class="article-overlay">
            <span class="article-category">Featured Article</span>
            <h1 class="article-title-hero" id="article-title-hero">Article Title</h1>
            <div class="article-meta-hero">
              <div class="meta-item">
                <div class="author-avatar" id="author-avatar">A</div>
                <span>By <strong id="article-author-hero">Author</strong></span>
              </div>
              <div class="meta-item">
                <i class="fas fa-calendar-alt"></i>
                <span id="article-date-hero">Today</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-clock"></i>
                <span>5 min read</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Article Content -->
        <div class="article-content">
          <div class="article-intro" id="article-intro">
            This is the article introduction that provides a compelling overview of what readers can expect...
          </div>
          
          <div class="article-body" id="article-body">
            <p>The full article content would appear here with detailed information, insights, and valuable content for readers.</p>
            <p>This preview gives you a taste of what's available in the complete article. Click the button below to continue reading and discover all the valuable insights and information.</p>
          </div>
        </div>

        <!-- Call to Action -->
        <div class="article-cta">
          <h3 class="cta-title">Continue Reading</h3>
          <p class="cta-description">Get the full story and discover all the details in the complete article.</p>
          <a href="#" id="continue-reading-btn" class="cta-button" onclick="handleContinueReading(event)">
            <i class="fas fa-external-link-alt"></i>
            Read Full Article
          </a>
        </div>

        <!-- Article Footer -->
        <footer class="article-footer">
          <div class="article-tags" id="article-tags">
            <!-- Tags will be populated here -->
          </div>
          
          <div class="share-section">
            <span class="share-title">Share this article:</span>
            <div class="share-buttons">
              <a href="#" class="share-btn twitter" onclick="shareOnTwitter()" title="Share on Twitter">
                <i class="fab fa-twitter"></i>
              </a>
              <a href="#" class="share-btn facebook" onclick="shareOnFacebook()" title="Share on Facebook">
                <i class="fab fa-facebook-f"></i>
              </a>
              <a href="#" class="share-btn linkedin" onclick="shareOnLinkedIn()" title="Share on LinkedIn">
                <i class="fab fa-linkedin-in"></i>
              </a>
              <a href="#" class="share-btn whatsapp" onclick="shareOnWhatsApp()" title="Share on WhatsApp">
                <i class="fab fa-whatsapp"></i>
              </a>
            </div>
          </div>
        </footer>
      </article>
    </main>
  </div>
  
  <!-- Error States -->
  <div id="error-state" class="error-container" style="display: none;">
    <div class="error-content">
      <i class="fas fa-exclamation-triangle error-icon"></i>
      <h2 class="error-title">Article Not Found</h2>
      <p class="error-description">
        The article you're looking for could not be found. It may have been moved, deleted, or the URL might be incorrect.
      </p>
      <div class="error-actions">
        <a href="/" class="btn">
          <i class="fas fa-home"></i>
          Go Home
        </a>
        <button onclick="location.reload()" class="btn btn-secondary">
          <i class="fas fa-redo"></i>
          Try Again
        </button>
      </div>
    </div>
  </div>
  
  <div id="permissions-error" class="error-container" style="display: none;">
    <div class="permissions-error">
      <h2><i class="fas fa-lock"></i> Database Access Error</h2>
      <h3>Configuration Required</h3>
      <p>The article service cannot access the database due to insufficient permissions. This needs to be fixed in your Firebase Console.</p>
      
      <p><strong>To fix this issue:</strong></p>
      <ul>
        <li>Go to your <a href="https://console.firebase.google.com/" target="_blank" style="color: var(--primary-color);">Firebase Console</a></li>
        <li>Select your project: <strong>lazada-finds</strong></li>
        <li>Navigate to <strong>Firestore Database</strong> → <strong>Rules</strong></li>
        <li>Update your security rules to allow read access to the 'redirects' collection</li>
      </ul>

      <p><strong>Example rule for public read access:</strong></p>
      <div class="code-block">
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /redirects/{document} {
      allow read: if true;
    }
  }
}
      </div>

      <div class="error-actions">
        <a href="/" class="btn">
          <i class="fas fa-home"></i>
          Go Home
        </a>
        <button onclick="location.reload()" class="btn btn-secondary">
          <i class="fas fa-redo"></i>
          Retry
        </button>
      </div>
    </div>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCkOR3z8emuYMJ-lRZzaskXcYZ3GC657jA",
      authDomain: "lazada-finds.firebaseapp.com",
      projectId: "lazada-finds",
      storageBucket: "lazada-finds.firebasestorage.app",
      messagingSenderId: "332344238384",
      appId: "1:332344238384:web:0f8b0f595b62127410a8f5"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentRedirectData = null;

    // Get URL parameters or slug
    function getRedirectInfo() {
      const urlParams = new URLSearchParams(window.location.search);
      
      console.log('URL params:', Object.fromEntries(urlParams));
      
      // Check if slug is passed as parameter (from .htaccess rewrite)
      if (urlParams.has('slug')) {
        console.log('Found slug parameter:', urlParams.get('slug'));
        return {
          type: 'slug',
          slug: urlParams.get('slug')
        };
      }
      
      // Check if it's a URL parameter redirect (u?title=... or redirect.html?title=...)
      if (urlParams.has('title') || urlParams.has('url')) {
        console.log('Found parameter redirect');
        return {
          type: 'params',
          title: urlParams.get('title') || '',
          url: urlParams.get('url') || '',
          description: urlParams.get('description') || '',
          image: urlParams.get('image') || '',
          canonical: urlParams.get('canonical') || '',
          keywords: urlParams.get('keywords') || '',
          author: urlParams.get('author') || ''
        };
      }
      
      console.log('No redirect info found in URL parameters');
      return null;
    }

    // Update meta tags and structured data
    function updateMetaTags(data) {
      const title = data.title || 'Article';
      const description = data.description || 'Read this amazing article on Article Hub.';
      const author = data.author || 'Article Hub';
      const image = data.image || '';
      const url = window.location.href;
      const canonical = data.canonical || url;
      
      // Basic meta tags
      document.getElementById('page-title').textContent = title;
      document.title = title;
      
      document.getElementById('page-description').setAttribute('content', description);
      document.getElementById('page-keywords').setAttribute('content', data.keywords || '');
      document.getElementById('page-author').setAttribute('content', author);
      
      // Open Graph tags
      document.getElementById('og-title').setAttribute('content', title);
      document.getElementById('og-description').setAttribute('content', description);
      document.getElementById('og-url').setAttribute('content', url);
      if (image) {
        document.getElementById('og-image').setAttribute('content', image);
      }
      
      // Twitter tags
      document.getElementById('twitter-title').setAttribute('content', title);
      document.getElementById('twitter-description').setAttribute('content', description);
      if (image) {
        document.getElementById('twitter-image').setAttribute('content', image);
      }
      
      // Canonical link
      document.getElementById('canonical-link').setAttribute('href', canonical);
      
      // Structured data
      const structuredData = {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": title,
        "description": description,
        "author": {
          "@type": "Person",
          "name": author
        },
        "publisher": {
          "@type": "Organization",
          "name": "Article Hub",
          "logo": {
            "@type": "ImageObject",
            "url": `${window.location.origin}/logo.png`
          }
        },
        "datePublished": data.createdAt ? data.createdAt.toDate().toISOString() : new Date().toISOString(),
        "dateModified": data.createdAt ? data.createdAt.toDate().toISOString() : new Date().toISOString(),
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": url
        }
      };
      
      if (image) {
        structuredData.image = {
          "@type": "ImageObject",
          "url": image
        };
      }
      
      document.getElementById('structured-data').textContent = JSON.stringify(structuredData);
    }

    // Show article content
    function showArticle(data) {
      currentRedirectData = data;
      
      // Update meta tags
      updateMetaTags(data);
      
      // Update article content
      const title = data.title || 'Untitled Article';
      const description = data.description || 'No description available.';
      const author = data.author || 'Anonymous';
      
      document.getElementById('article-title-hero').textContent = title;
      document.getElementById('article-author-hero').textContent = author;
      document.getElementById('article-date-hero').textContent = data.createdAt ? 
        new Date(data.createdAt.toDate()).toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        }) : 'Recently';
      
      // Set author avatar
      document.getElementById('author-avatar').textContent = author.charAt(0).toUpperCase();
      
      // Handle image
      const imageEl = document.getElementById('article-image');
      if (data.image) {
        imageEl.src = data.image;
        imageEl.alt = title;
        imageEl.style.display = 'block';
      } else {
        imageEl.style.display = 'none';
      }
      
      // Update article intro and body
      document.getElementById('article-intro').textContent = description;
      
      // Generate article body preview
      const bodyText = `
        ${description}
        
        This is a preview of the full article. The complete content contains detailed information, insights, and valuable resources that will help you understand the topic better.
        
        Click the "Read Full Article" button below to access the complete content and discover all the valuable information available.
      `;
      
      document.getElementById('article-body').innerHTML = bodyText.split('\n').map(p => p.trim()).filter(p => p).map(p => `<p>${p}</p>`).join('');
      
      // Update continue reading button
      const continueBtn = document.getElementById('continue-reading-btn');
      continueBtn.href = data.url || '#';
      
      // Generate tags
      if (data.keywords) {
        const tags = data.keywords.split(',').map(tag => tag.trim()).filter(tag => tag);
        const tagsContainer = document.getElementById('article-tags');
        tagsContainer.innerHTML = tags.map(tag => 
          `<span class="tag">#${tag}</span>`
        ).join('');
      }
      
      // Show article content and hide loading
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('article-content').style.display = 'block';
    }

    // Show permissions error
    function showPermissionsError() {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('permissions-error').style.display = 'block';
    }

    // Show error
    function showError(debugInfo = null) {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('error-state').style.display = 'block';
    }

    // Handle continue reading click
    function handleContinueReading(event) {
      event.preventDefault();
      
      if (!currentRedirectData || !currentRedirectData.url) {
        alert('No destination URL available');
        return;
      }
      
      // Update click count if it's a slug-based redirect
      if (currentRedirectData.slug) {
        updateClickCount(currentRedirectData.slug);
      }
      
      // Redirect to the destination URL
      window.open(currentRedirectData.url, '_blank');
    }

    // Social sharing functions
    function shareOnTwitter() {
      if (!currentRedirectData) return;
      const text = encodeURIComponent(`Check out this article: ${currentRedirectData.title}`);
      const url = encodeURIComponent(window.location.href);
      window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank', 'width=600,height=400');
    }

    function shareOnFacebook() {
      if (!currentRedirectData) return;
      const url = encodeURIComponent(window.location.href);
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank', 'width=600,height=400');
    }

    function shareOnLinkedIn() {
      if (!currentRedirectData) return;
      const url = encodeURIComponent(window.location.href);
      const title = encodeURIComponent(currentRedirectData.title || '');
      const summary = encodeURIComponent(currentRedirectData.description || '');
      window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}&title=${title}&summary=${summary}`, '_blank', 'width=600,height=400');
    }

    function shareOnWhatsApp() {
      if (!currentRedirectData) return;
      const text = encodeURIComponent(`${currentRedirectData.title} - ${window.location.href}`);
      window.open(`https://wa.me/?text=${text}`, '_blank');
    }

    // Update click count
    async function updateClickCount(slug) {
      try {
        const docRef = db.collection('redirects').doc(slug);
        await docRef.update({
          clicks: firebase.firestore.FieldValue.increment(1),
          lastClicked: firebase.firestore.FieldValue.serverTimestamp()
        });
        console.log('Click count updated for:', slug);
      } catch (error) {
        console.error('Error updating click count:', error);
      }
    }

    // Check if error is permissions related
    function isPermissionsError(error) {
      return error.code === 'permission-denied' || 
             error.message.includes('Missing or insufficient permissions') ||
             error.message.includes('permission-denied');
    }

    // Main redirect logic
    async function handleRedirect() {
      console.log('Starting article loader...');
      const redirectInfo = getRedirectInfo();
      
      console.log('Redirect info:', redirectInfo);
      
      if (!redirectInfo) {
        console.log('No redirect info found');
        showError();
        return;
      }
      
      if (redirectInfo.type === 'params') {
        console.log('Handling parameter redirect');
        if (!redirectInfo.url) {
          console.log('No URL in parameters');
          showError();
          return;
        }
        
        showArticle(redirectInfo);
        
      } else if (redirectInfo.type === 'slug') {
        console.log('Handling slug redirect for:', redirectInfo.slug);
        try {
          const doc = await db.collection('redirects').doc(redirectInfo.slug).get();
          
          if (!doc.exists) {
            console.log('Document not found for slug:', redirectInfo.slug);
            showError();
            return;
          }
          
          const data = doc.data();
          console.log('Found redirect data:', data);
          
          if (!data.url) {
            console.log('No URL in document data');
            showError();
            return;
          }
          
          // Add slug to data for click tracking
          data.slug = redirectInfo.slug;
          showArticle(data);
          
        } catch (error) {
          console.error('Error fetching redirect:', error);
          
          if (isPermissionsError(error)) {
            console.log('Permissions error detected');
            showPermissionsError();
          } else {
            showError();
          }
        }
      }
    }

    // Initialize when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', handleRedirect);
    } else {
      handleRedirect();
    }
  </script>
</body>
</html>